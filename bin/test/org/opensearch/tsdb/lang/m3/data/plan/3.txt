MOVING(1h, AVG)
  TRANSFORM_NULL(0.0)
    AS_PERCENT(groupBy=[city_name, region])
      MOVING(1h, SUM)
        TRANSFORM_NULL(0.0)
          AGG(SUM, groupBy=[city_name])
            FETCH({region=[west]}, !{})
      AGG(AVG, groupBy=[])
        UNION
          MOVING(1h, SUM)
            TRANSFORM_NULL(0.0)
              AGG(SUM, groupBy=[city_name])
                FETCH({region=[west]}, !{})
          TIMESHIFT(1d)
            MOVING(1h, SUM)
              TRANSFORM_NULL(0.0)
                AGG(SUM, groupBy=[city_name])
                  FETCH({region=[west]}, !{})
          TIMESHIFT(2d)
            MOVING(1h, SUM)
              TRANSFORM_NULL(0.0)
                AGG(SUM, groupBy=[city_name])
                  FETCH({region=[west]}, !{})
